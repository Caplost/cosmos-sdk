digraph {
	compound=true;
	node [shape=Mrecord];
	rankdir="LR";

	CheckForManualUpgradeBatch [label="CheckForManualUpgradeBatch|entry / CheckForManualUpgradeBatch-fm"];
	CheckForUpgradeInfoJSON [label="CheckForUpgradeInfoJSON|entry / CheckForUpgradeInfoJSON-fm"];
	CheckLastKnownHeight [label="CheckLastKnownHeight|entry / CheckLastKnownHeight-fm"];
	DoUpgrade [label="DoUpgrade"];
	Run [label="Run|entry / Start-fm"];
	RunWithHaltHeight [label="RunWithHaltHeight|entry / StartWithHaltHeight-fm\nentry / CheckActualHeight-fm"];
	ShutdownAndRestart [label="ShutdownAndRestart|entry / Stop-fm"];
	CheckForManualUpgradeBatch -> CheckLastKnownHeight [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">haveManualUpgrades</TD></TR></TABLE>>];
	CheckForManualUpgradeBatch -> Run [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">noManualUpgrades</TD></TR></TABLE>>];
	CheckForUpgradeInfoJSON -> CheckForManualUpgradeBatch [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">haveUpgradePlan</TD></TR></TABLE>>];
	CheckForUpgradeInfoJSON -> DoUpgrade [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">noUpgradePlan</TD></TR></TABLE>>];
	CheckLastKnownHeight -> RunWithHaltHeight [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">onReadLastKnownHeight [beforeManualUpgradeHeight]</TD></TR></TABLE>>];
	CheckLastKnownHeight -> DoUpgrade [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">onReadLastKnownHeight [atManualUpgradeHeight]</TD></TR></TABLE>>];
	CheckLastKnownHeight -> FatalError [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">onReadLastKnownHeight [pastManualUpgradeHeight]</TD></TR></TABLE>>];
	DoUpgrade -> FatalError [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">onUpgradeError</TD></TR></TABLE>>];
	DoUpgrade -> CheckForManualUpgradeBatch [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">onUpgradeSuccess [allowDaemonRestart]</TD></TR></TABLE>>];
	DoUpgrade -> Done [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">onUpgradeSuccess [disableDaemonRestart]</TD></TR></TABLE>>];
	Run -> ShutdownAndRestart [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">haveUpgradePlan</TD></TR><TR><TD ALIGN="LEFT">onGotNewManualUpgrade</TD></TR></TABLE>>];
	RunWithHaltHeight -> ShutdownAndRestart [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">haveUpgradePlan</TD></TR><TR><TD ALIGN="LEFT">onGotActualHeight [haveWrongHaltHeight]</TD></TR><TR><TD ALIGN="LEFT">onGotNewManualUpgrade</TD></TR><TR><TD ALIGN="LEFT">onReachedHaltHeight</TD></TR></TABLE>>];
	ShutdownAndRestart -> CheckForUpgradeInfoJSON [label=<<TABLE BORDER="0"><TR><TD ALIGN="LEFT">onProcessExit</TD></TR></TABLE>>];
	init [label="", shape=point];
	init -> CheckForUpgradeInfoJSON
}
